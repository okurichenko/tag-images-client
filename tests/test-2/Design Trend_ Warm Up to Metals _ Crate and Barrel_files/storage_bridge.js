/* Copyright Â© 2014-2017 Moxie Software. All Rights Reserved. Concierge Version: v1.0.8 */
!function(){"use strict";function e(e){if(null===e)return null;try{var s=e.charAt(0);return"{"===s||"["===s||'"'===s?JSON.parse(e):e}catch(t){return u("JSON: storage bridge unable to parse: ",e),""}}function s(){return!0}function t(e,s){return e=e||{},s.requesterId&&(e.requesterId=s.requesterId),s.requestId&&(e.requestId=s.requestId),e.bridgeName="storage_bridge",e}function r(s){var r=s.client,i=0,n="",o="";if(l=r+"|client-keys",g={ls:localStorage.getItem(l),ss:sessionStorage.getItem(l)},c={ls:{},ss:{}},g.ls)for(g.ls=e(g.ls),i=0;i<g.ls.length;i++)n=localStorage.getItem(g.ls[i]),o=g.ls[i].split("|")[1],c.ls[o]=e(n);else g.ls=[],c.ls={};if(g.ss)for(g.ss=e(g.ss),i=0;i<g.ss.length;i++)n=sessionStorage.getItem(g.ss[i]),o=g.ss[i].split("|")[1],c.ss[o]=e(n);else g.ss=[],c.ss={};return t({request:"initResponse",lsValue:c.ls,ssValue:c.ss},s)}function i(e){var s,r,i,n,o=e.client+"|";for(n=[],s=0,r=localStorage.length;s<r;++s)i=localStorage.key(s),0===i.indexOf(o)&&n.push(localStorage.key(s));for(s=0,r=n.length;s<r;s++)localStorage.removeItem(n[s]);for(g.ls={},localStorage.setItem(l,JSON.stringify(g.ls)),n=[],s=0,r=sessionStorage.length;s<r;++s)i=sessionStorage.key(s),0===i.indexOf(o)&&n.push(sessionStorage.key(s));for(s=0,r=n.length;s<r;s++)sessionStorage.removeItem(n[s]);return g.ss={},sessionStorage.setItem(l,JSON.stringify(g.ss)),t({request:"ack"},e)}function n(e){var s=e.client+"|"+e.key;return e.persist?(g.ls.indexOf(s)===-1&&(g.ls.push(s),localStorage.setItem(l,JSON.stringify(g.ls))),localStorage.setItem(s,JSON.stringify(e.value))):(g.ss.indexOf(s)===-1&&(g.ss.push(s),sessionStorage.setItem(l,JSON.stringify(g.ss))),sessionStorage.setItem(s,JSON.stringify(e.value))),t({request:"ack"},e)}function o(e){var s=e.client+"|"+e.key;return e.persist?g.ls.indexOf(s)!==-1&&(g.ls.splice(g.ls.indexOf(s),1),localStorage.setItem(l,JSON.stringify(g.ls)),localStorage.removeItem(s)):g.ss.indexOf(s)!==-1&&(g.ss.splice(g.ss.indexOf(s),1),sessionStorage.setItem(l,JSON.stringify(g.ss)),sessionStorage.removeItem(s)),t({request:"ack"},e)}function a(e){var a=e.data;if("string"==typeof a)try{a=JSON.parse(a)}catch(l){return void u(l)}if(s(e.origin)&&d(a))try{switch(a.request){case"init":e.source.postMessage(JSON.stringify(f(r(a))),e.origin);break;case"clear":e.source.postMessage(JSON.stringify(f(i(a))),e.origin);break;case"store":e.source.postMessage(JSON.stringify(f(n(a))),e.origin);break;case"remove":e.source.postMessage(JSON.stringify(f(o(a))),e.origin)}}catch(g){"init"===a.request&&e.source.postMessage(JSON.stringify(t({request:"initFailed"},a)),e.origin)}}var l="",g={},c={},u=function(e){"undefined"!=typeof window.GoMoxie&&"undefined"!==window.GoMoxie.console?window.GoMoxie.console.log(e):"undefined"!=typeof window.console&&window.console.log(e)},f=function(e){return e.signature="moxie_concierge",e},d=function(e){return"moxie_concierge"===e.signature};window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a)}();