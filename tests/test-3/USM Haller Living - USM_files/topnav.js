define(['jquery','./USM'],function($){'use strict';$(function(){var pluginName='topnav',triggerEl='.horizontal-nav',defaults={};function Plugin(element,options){this.$element=$(element);this.settings=$.extend({},defaults,options);this.api={};this._defaults=defaults;this._name=pluginName;this.init();}
Plugin.prototype.init=function(){var $subnavs=this.$element.find('.nav-sub'),$metaLink=this.$element.find('.nav-meta .nav-link');$subnavs.insertAfter('.nav-wrapper');if($subnavs.find('> .nav-sub > .nav-mob > .nav-link.current').length){$('.usm-wrapper').addClass('has-subnav');}
$('<div class="subnav-overlay"></div>').insertAfter($('.nav-wrapper'));this.$navItem=this.$element.find('.nav-main .nav-link');this.$navItem.on('click',$.proxy(this.openSubnav,this));this.$subnavToggle=this.$element.find('.nav-mob .nav-link');this.$subnavToggle.on('click',$.proxy(this.openSubnav,this));$('body').on('click',$.proxy(this.closeAll,this));$metaLink.each(function(){var $this=$(this);$this.append('<div class="meta-tooltip"><span>'+$this.text()+'</span></div>');});$metaLink.on('mouseover',function(){$(this).find('.meta-tooltip').addClass('visible');}).on('mouseout',function(){$(this).find('.meta-tooltip').removeClass('visible');});};Plugin.prototype.openSubnav=function(e){e.preventDefault();e.stopPropagation();var $link=$(e.target);var $subnav=$('#subnav-'+$link.data('subnav-page')+' > .nav-sub-wrapper');if($subnav.hasClass('active')){this.closeAll(e);$link.removeClass('subnav-open').blur();this.$element.removeClass('flyout-open');}else{if($subnav.length){this.closeAll(e);$('.subnav-overlay').fadeIn();$subnav.parent().insertAfter($('.nav-wrapper'));$subnav.addClass('active').slideDown();$link.addClass('subnav-open');if(!$link.siblings().length){$subnav.clone().insertAfter($link).css('height','auto').addClass('subnav-mobile').css('display','none');}
$link.next().slideDown();this.$element.addClass('flyout-open');}else{window.location.href=$link.attr('href');}}};Plugin.prototype.closeAll=function(e){if($(e.target).closest('.nav-sub-1').length>0){return;}
if($(e.target).parent().siblings('.nav-item').find('.subnav-open').length===0){$('.subnav-overlay').fadeOut();}
this.$element.removeClass('flyout-open');this.$navItem.removeClass('subnav-open');$('.nav-sub-wrapper').slideUp(function(){$(this).removeClass('active');$(this).parent().removeClass('active');});};$.fn[pluginName]=function(options){var args=arguments;this.each(function(){if(!options||typeof options==='object'){if(!$.data(this,'plugin_'+pluginName)){$.data(this,'plugin_'+pluginName,new Plugin(this,options));}}else if(typeof options==='string'){var instance=$(this).data('plugin_'+pluginName);if(instance.api&&instance.api[options]){instance.api[options].apply(instance,Array.prototype.slice.call(args,1));}}});return this;};$(triggerEl)[pluginName]();});});