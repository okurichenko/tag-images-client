define(['jquery','./USM'],function($,USM){'use strict';$(function(){var Checkboxes=function(el,options){var self=this;self.settings=$.extend({},$.fn.checkboxes.defaults,options);self.$el=$(el);self.$cbx=$('<div/>').addClass('cbx');self.myTrigger=self.trigger();self.myTrigger.init();};Checkboxes.prototype.trigger=function(){var self=this,mod={},$elParent=self.$el.parent(),cbxClasses=self.$el.attr('class')?self.$el.attr('class'):'',$cbxOptions=$('<div/>').addClass('cbx-options'),$cbxSelect=$('<div/>').addClass('cbx-select'),$cbxSelected=$('<div/>').addClass('cbx-selected'),$orgOptions=self.$el.find('option'),$orgSelected=$orgOptions.filter(':selected').first(),$resetButton=self.$el.parents('form').find('[type="reset"]').first();mod.init=function(){self.$cbx.addClass(cbxClasses);var $label=$('label[for='+$orgOptions.parent().attr('id')+']').first();$cbxSelected.text($label.text())
$orgOptions.each(function(index){var $this=$(this),$option=$('<div/>').addClass('cbx-option'),$cbxOption=$('<input>',{type:"checkbox","class":"frm-ckbx-i"});$option.data('cbx-index',index).data('cbx-val',$this.val()).html('<label class="frm-ckbx">'+$this.text()+'</label>').prepend($cbxOption).appendTo($cbxOptions);$option.on('click',mod.setOption);$cbxOption.on('change',mod.setOption);$this.data('cbx-index',index);if($this.attr('selected')){$option.trigger("click");}});$cbxSelect.append($cbxSelected).appendTo(self.$cbx);$elParent.append($cbxOptions);self.$el.replaceWith(self.$cbx);self.$el.appendTo(self.$cbx);self.$cbx.on('click','.cbx-selected',mod.toggleOptions);self.$cbx.data('cbxSelectByValue',mod.selectOptionByValue);if($resetButton.length){$resetButton.click(mod.reset);}};mod.toggleOptions=function(){$('.cbx-select').removeClass('active');if($cbxOptions.hasClass('active')){mod.hideOptions();}else{$cbxSelect.addClass('active');mod.showOptions($cbxSelect);}
return false;};mod.showOptions=function($cbxSelect){$cbxOptions.addClass('active');$('.cbx-options.active').not($cbxOptions).removeClass('active');if($('.nav-mob').css('display')==='block'){$cbxSelect.after($cbxOptions);}
return false;};mod.hideOptions=function($filterGroup){$cbxOptions.removeClass('active');if($('.nav-mob').css('display')==='block'){$cbxOptions.appendTo($cbxOptions.closest('.filter-group'));}
$(document).off('click.cbx');return false;};mod.setOption=function(e){var $this=$(e.currentTarget),index=$this.data('cbx-index'),val=$this.data('cbx-val'),text=$this.text();if($this.hasClass('active')){mod.unselectOptionByIndex(index);mod.removeAppliedFilter(index);}else{mod.selectOptionByIndex(index);mod.addAppliedFilter(index,val,text);}};mod.selectOptionByIndex=function(index,silent){var $this=$cbxOptions.children().eq(index);$orgOptions.eq(index).attr('selected',true);$this.addClass('active');$this.find('input:checkbox:first').attr('checked','checked');self.$cbx.removeClass('error');if(!silent){$(USM.events).trigger('CBX_CHANGE',[self.$el,self.$cbx]);}
return false;};mod.unselectOptionByIndex=function(index,silent){var $this=$cbxOptions.children().eq(index);$orgOptions.eq(index).attr('selected',false);$this.removeClass('active');$this.find('input:checkbox:first').attr('checked',false);self.$cbx.removeClass('error');if(!silent){$(USM.events).trigger('CBX_CHANGE',[self.$el,self.$cbx]);}
return false;};mod.selectOptionByValue=function(value,silent){var $this=$cbxOptions.children().filter(function(){return $(this).data('cbx-val')===value;}),index=$this.first().data('cbx-index');if(index!==undefined){mod.selectOptionByIndex(index,silent);}};mod.addAppliedFilter=function(index,val,text){if(index===undefined)return;var $filter=$('<div/>').addClass('appl-fltr').attr('id','appl-fltr-'+index),$closeBtn=$('<div/>').addClass('close-fltr'),$filterWrap=$('#appl-fltrs');$closeBtn.on('click',function(){mod.removeAppliedFilter(index);mod.unselectOptionByIndex(index);});if($('.appl-fltr').length===0){$filterWrap.removeClass('visually-hidden');}
$filter.data('fltr-index',index).data('fltr-val',val).text(text).append($closeBtn).appendTo($filterWrap);return false;};mod.removeAppliedFilter=function(index){if(index===undefined)return;$('#appl-fltr-'+index).remove();if($('.appl-fltr').length===0){$('#appl-fltrs').addClass('visually-hidden');}
return false;};return{init:mod.init};};$.fn.checkboxes=function(options){return this.each(function(){var self=$(this);if(typeof options==='object'||!options){if(!self.data('checkboxes')){self.data('checkboxes',new Checkboxes(self,options));}}});};$.fn.checkboxes.defaults={};$('form select').filter(function(){return $(this).hasClass('cbx')===true;}).checkboxes();});});