define(['jquery','jquery.cookie'],function($){'use strict';$(function(){var SimpleNewsletter=function(el,options){var self=this;self.settings=$.extend({},$.fn.simpleNewsletter.defaults,options);self.$el=$(el);self.$html=$('html');self.$window=$(window);self.$open=$('.open-simple-newsletter');self.$autoopen=$('#auto-open-simple-newsletter');self.$form=self.$el.find('.nfm-form');self.$close=self.$el.find('.nfm-close');self.$submit=self.$el.find('.nfm-submit');self.$success=self.$el.find('.nfm-success');self.$error=self.$el.find('.nfm-error');self.$ok=self.$el.find('.nfm-ok');try{self.cookie=JSON.parse($.cookie('simple-newsletter'));}catch(error){self.cookie={subscribed:false,closed:false};}
var auto_open=self.$autoopen.attr('data-auto-open');console.log("auto_open: "+auto_open);if(!self.cookie.subscribed&&!self.cookie.closed&&auto_open=="1"){self.myNewsletter=self.newsletter();self.myNewsletter.init();}
$('.open-newsletter').click(function(){console.log(".open-newsletter.click");self.myNewsletter=self.newsletter();self.myNewsletter.init();});};SimpleNewsletter.prototype.newsletter=function(){var self=this,mod={};mod.init=function(){if(self.$html.hasClass('no-touch')){self.$window.on('mouseleave',mod.onMouseLeave.bind(self));}else{self.$el.show();}
self.$submit.on('click',mod.onSubmit.bind(self));self.$close.on('click',mod.onClose.bind(self));self.$ok.on('click',mod.onClose.bind(self));};mod.onSubmit=function(e){if(e.preventDefault){e.preventDefault();}
if(self.$submit.hasClass('disabled')){return;}
self.$submit.addClass('disabled');var data=self.$form.serializeArray();$.post(self.$form.attr('action'),data).done(function(data,status,request){if(status==='success'){if(data.errors){var fields=Object.keys(data.errors);var inputs=self.$form.find('input, .sbx, select').removeClass('error');for(var i=inputs.length-1;i>=0;i--){var $input=$(inputs[i]);if($input.hasClass('sbx')){var select=$input.find('select');if(select.length===1){select=$(select.get(0));if(fields.indexOf(select.attr('name'))!==-1){select.addClass('error');$input.addClass('error');$input.parent('.frm-row').addClass('has-error');}}}else{if(fields.indexOf($input.attr('name'))!==-1){$input.addClass('error');$input.parent('.frm-row').addClass('has-error');}}}
self.$submit.removeClass('disabled');}else{self.$submit.removeClass('disabled');if(data.success){self.$form.hide();self.$success.show();self.cookie.subscribed=true;self.settings.cookieConfig.expires=365;$.cookie('simple-newsletter',JSON.stringify(self.cookie),self.settings.cookieConfig);}}}}).fail(function(){self.$form.hide();self.$error.show();});};mod.onClose=function(e){if(e.preventDefault){e.preventDefault();}
self.$el.remove();self.cookie.closed=true;if(self.cookie.subscribed){self.settings.cookieConfig.expires=365;}
$.cookie('simple-newsletter',JSON.stringify(self.cookie),self.settings.cookieConfig);};mod.onMouseLeave=function(e){if(!self.settings.isOpen&&e.clientY<=0.5*self.$window.innerHeight()){self.settings.isOpen=true;self.$el.show();}};return{init:mod.init};};$.fn.simpleNewsletter=function(options){return this.each(function(){var self=$(this);if(typeof options==='object'||!options){if(!self.data('simpleNewsletter')){self.data('simpleNewsletter',new SimpleNewsletter(self,options));}}});};$.fn.simpleNewsletter.defaults={isOpen:false,cookieConfig:{expires:30}};$('.nfm').simpleNewsletter();});});