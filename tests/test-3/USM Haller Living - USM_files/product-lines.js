define(['./USM','jquery','jquery.sticky'],function(USM,$){'use strict';$(function(){if($('.pl-tabs').length){var tabsToMobileNav=false;var copyTabsToMobileNav=function(){var $currentSite;if($('.swp-item').length>1){$currentSite=$('.swp-item.active');}else{$currentSite=$('.content-wrapper');}
var $tabLinks=$currentSite.find('.pl-tabs-t').children().clone(),$current=$tabLinks.filter('.active').clone().removeClass('pl-tabs-l active').addClass('jQ-mob-link nav-link current'),$wrapper=$('<div/>').addClass('nav-mob nav-mob-additional jQ-mob-trigger'),$itemWrapper=$('<ul/>').addClass('nav-lvl2 jQ-mob-target');if($tabLinks.length<2){return;}
$wrapper.append($current);$tabLinks.each(function(){$('<li/>').addClass('nav-mob-item').append($(this).removeClass('pl-tabs-l').addClass('nav-link')).appendTo($itemWrapper);});$wrapper.appendTo('.nav-subnav');$itemWrapper.appendTo('.nav-subnav');var $anchorLinks=$currentSite.find('.pl-subnav-anchors').children(),$current=$anchorLinks.first().clone().removeClass('pl-subnav-link').addClass('jQ-mob-link nav-link current'),$wrapper=$('<div/>').addClass('nav-mob nav-mob-additional jQ-mob-trigger'),$itemWrapper=$('<ul/>').addClass('nav-lvl2 jQ-mob-target');if($anchorLinks.length<2){return;}
$wrapper.append($current);$anchorLinks.each(function(){$('<li/>').addClass('nav-mob-item').append($(this).removeClass('pl-subnav-link').addClass('nav-link nav-anchor')).appendTo($itemWrapper);});$wrapper.appendTo('.nav-subnav');$itemWrapper.appendTo('.nav-subnav');$('.pl-subnav').remove();tabsToMobileNav=true;};$(window).resize(function(){if(!tabsToMobileNav&&$(window).width()<=USM.config.BP_SMARTPHONE_MAX){copyTabsToMobileNav();}});if(!tabsToMobileNav&&$(window).width()<=USM.config.BP_SMARTPHONE_MAX){copyTabsToMobileNav();}}
$('.product-lines-teaser .plt-desc').click(function(){if($(window).width()<=USM.config.BP_SMARTPHONE_MAX){var $toggleParent=$(this).parents('.plt');$toggleParent.toggleClass('open');$toggleParent.find('.plt-toggle').slideToggle();return false;}});var menu_height=$('.pl-subnav-anchors, .plt-overview').first().height(),$menu_links=$('.pl-subnav-anchors a, a.nav-anchor, .plt-overview a'),$scroll_targets=$menu_links.map(function(){return $($(this).attr('href'));}),width=$(window).width(),$navWrapper=$('.nav-wrapper'),buffer=0,topSpacing=0;if($menu_links.parent().hasClass("pl-subnav-anchors")){buffer=40;}
function softScroll($a){$('html, body').animate({scrollTop:$($a.attr('href')).offset().top-topSpacing-menu_height-buffer},'slow');}
$menu_links.on('click',function(){softScroll($(this));});if(window.location.hash){var $el=$("a[href="+window.location.hash+"]");setTimeout(function(){$el.trigger('click');},200);}
$('.nav-main-sub .nav-link').on('click',function(e){e.preventDefault();var $this=$(this);var href=$this.attr('href');$this.attr('href','#'+href.split("#")[1]);if($($this.attr('href')).length>0){softScroll($this);}else{window.location=href;}});$(window).on('resize',function(){topSpacing=$navWrapper.css('position')==='fixed'?$navWrapper.height():0;$('.pl-subnav-anchors').unstick();$('.pl-subnav-anchors').sticky({getWidthFrom:'.pl-tabs',topSpacing:topSpacing});$('.plt-overview').unstick();$('.plt-overview').sticky({getWidthFrom:'.product-lines-list',topSpacing:topSpacing});});$(window).trigger('resize');$(window).scroll(function(){var $window=$(this),fromTop=$window.scrollTop()+topSpacing+menu_height+buffer+2,scrolled_past=$scroll_targets.filter(function(){return $(this).offset().top<fromTop});$menu_links.removeClass('active');if(scrolled_past.length){$menu_links.filter('[href=#'+(scrolled_past[scrolled_past.length-1].attr('id'))+']').addClass('active');}});});});